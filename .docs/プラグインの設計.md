# プラグインの設計


---

## 目次

- [プラグインの管理](#プラグインの管理)
- [自作プラグインの管理](#自作プラグインの管理)
- [コード管理](#コード管理)
- [📃 **補遺**](#-補遺)

---

> 当開発環境では、
> ・インストールしたプラグインの内容をホストで確認・編集する
> ・自作プラグインの開発
> が可能です。

## プラグインの管理

プラグインは`/plugins` で管理します。

このディレクトリはコンテナの`/var/www/html/wp-content/plugins` にマウントしています。

```typescript
  volumes:
      
      # 省略...
      
      - "../plugins:/var/www/html/wp-content/plugins"
```

一般的に外部プラグインのコードを直接編集することは少ないですが、
**実装を確認できる状態にしておくことで、保守性やトラブルシューティングのしやすさが向上します。**

## 自作プラグインの管理

プラグインを自作する際は、`/plugins` にプラグインを追加してください。
ホスト側で追加されたプラグインは、コンテナの`/var/www/html/wp-content/plugins` にマウントされ、Wordpressに読み込まれます。

**この時、プラグインのファイル名は「**`custom-`**から始めてください。**理由は次の項目に記述します。

```plaintext
plugins/
├── advanced-custom-fields-pro/  ← 外部プラグイン
├── akismet/ ← 外部プラグイン
├── custom_dummy-post-generator/ ← 自作プラグイン
```

## コード管理

すべてのプラグインをリポジトリで管理すると、アップデートのたびに大量の差分が発生したり、プッシュ・クローン時のデータ量が増えてしまいます。
ただし、自作プラグインについてはソースコードを継続的に保守・共有する必要があるため、Git 上での管理が望ましいと考えています。

そこで、`.gitignore` を以下のように設定し、**外部プラグインは無視しつつ、自作プラグイン（**`custom_`** で始まるディレクトリ）のみを管理対象としています。**

```plaintext
plugins/*
!plugins/custom_*/
```

## 📃 **補遺**

> 元々、自作プラグインは`/wp-content/plugins/myplugins` で管理しようと考えていました。
> 
> しかし、wordpressは`plugins`の直下にあるものしかプラグインとして認識しません。
> 
> そこで、`docker-compose.yml > volumes`の設定にて、各プラグインを`/var/www/html/wp-content/plugins`へマウントしようと考えましたが、プラグインを作成するごとに`volums`を編集し、コンテナを再ビルドする必要があり、効率的でありませんでした。
> 
> また、シンボリックリンクを使って `/myplugin` 配下から `/plugins` にリンクを張る方法もありますが、この方法は `init.sh` にシンボリックリンク生成の処理を記述する必要があり、スクリプトの複雑化や、仕組みがブラックボックス化する懸念がありました。
> 
> 以上の理由から、**テーマ開発とプラグイン開発を効率性を保ったまま両立するため**に、現在の運用方針に落ち着きました。
> 
> （プラグイン開発はこれが初で、まだまだ知見が浅い状態です。良いアイデアがあれば試していきたいです…）
